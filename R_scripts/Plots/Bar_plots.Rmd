```{r}
library(Seurat)
library(ggplot2)
library(dplyr)
```



```{r}
# Load in the object
setwd("C:/Users/Robbe Fonteyn/OneDrive - UGent/AJ 2024-2025/Master's_Dissertation/AML-CITEseq/Data")
SAB <- readRDS("SAB_slimmed_final_harmony.rds")
metadata <- SAB@meta.data
```

```{r}
rm(SAB)
output_dir <- "C:/Users/Robbe Fonteyn/OneDrive - UGent/AJ 2024-2025/Master's_Dissertation/Graphs/Merge_plots"
```


```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], Patient) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = Patient)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of patients Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Patient") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Patients_per_SeuratCluster_Full_SAB.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```

```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], predicted.celltype.l1) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = predicted.celltype.l1)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of Azimuth Cell Types (Layer 1) Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Azimuth Cell Type") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Azimuth_Celltypes_l1_per_SeuratCluster_Full_SAB_Harmony.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```

```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], Triana_celltype) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = Triana_celltype)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of Triana Cell Types Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Triana Cell Type") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Triana_Celltypes_per_SeuratCluster_Full_SAB.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```

```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], Genetics) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = Genetics)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of phenotypes Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Phenotype") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Phenotypes_per_SeuratCluster_Full_SAB.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```

```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], exp) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = exp)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of experiments Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Experiments") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Exp_per_SeuratCluster_Full_SAB.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```

```{r}
#!!!!!!!!!!!!!!!!!!! Nothing needs to be edited except the filename !!!!!!!!!!!!!!!!!!!!!
library(dplyr)
library(ggplot2)

# Extract metadata
metadata <- SAB@meta.data

# Count how many cells are in each cluster-patient combination
cluster_patient_counts <- metadata %>%
  group_by(RNA_snn_res.0.8, Patient) %>%
  summarise(CellCount = n(), .groups = "drop")

# Convert to factors for controlled plotting
cluster_patient_counts$RNA_snn_res.0.8 <- factor(cluster_patient_counts$RNA_snn_res.0.8)
cluster_patient_counts$Patient <- factor(cluster_patient_counts$Patient)

# Plot: clusters on X, patients stacked in bars
plot <- ggplot(cluster_patient_counts, aes(x = RNA_snn_res.0.8, y = CellCount, fill = Patient)) +
  geom_bar(stat = "identity", color = "black", size = 0.1) +
  labs(x = "Seurat Cluster", y = "Number of Cells", fill = "Patient") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 6),
    legend.title = element_text(size = 7),
    legend.key.size = unit(0.3, "cm")
  ) +
  guides(fill = guide_legend(ncol = 1))
plot
```

```{r}
library(Seurat)
library(dplyr)
library(ggplot2)

# Extract metadata
#metadata <- SAB@meta.data

# Specify Seurat cluster column
cluster_col <- "RNA_snn_res.0.8"  # Adjust if needed

# Summarize counts of predicted cell types per cluster
cluster_celltype_counts <- metadata %>%
  group_by(Cluster = .data[[cluster_col]], Azimuth_cluster_majority_celltype) %>%
  summarise(CellCount = n(), .groups = "drop")

# Sort clusters numerically
cluster_celltype_counts <- cluster_celltype_counts %>%
  mutate(Cluster = factor(Cluster, levels = sort(as.numeric(unique(as.character(Cluster))))))

# Create plot with black bar outlines and compact legend
plot <- ggplot(cluster_celltype_counts, aes(x = Cluster, y = CellCount, fill = Azimuth_cluster_majority_celltype)) +
  geom_bar(stat = "identity", color = "black", size = 0.05) +
  labs(
    title = "Distribution of Azimuth Majority Across Seurat Clusters",
    x = "Seurat Cluster",
    y = "Number of Cells",
    fill = "Azimuth Cell type") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 5),              # Smaller legend text
    legend.title = element_text(size = 6),             # Smaller legend title
    legend.key.size = unit(0.2, "cm")                  # Smaller color boxes
  ) +
  guides(fill = guide_legend(ncol = 1))                # Single-column legend

# Save the plot
ggsave(
  filename = file.path(output_dir, "Azimuth_majority_celltype_per_SeuratCluster_Full_SAB_Harmony.jpg"),
  plot = plot,
  width = 8,
  height = 6,
  dpi = 300
)

```